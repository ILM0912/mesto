(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{I:()=>f});var t={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"0542bd93-550e-4ccd-a9a7-ab811b62fa15","Content-Type":"application/json"}},n=function(e,n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:e,headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function o(e){e.classList.add("popup_is-opened"),e.addEventListener("click",c),document.addEventListener("keydown",a)}function r(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",c),document.removeEventListener("keydown",a)}function c(e){e.target===e.currentTarget&&r(e.currentTarget)}function a(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}var u=document.querySelector("#card-template").content,i=document.querySelector(".popup_type_image"),s=i.querySelector(".popup__image"),l=i.querySelector(".popup__caption"),d=i.querySelector(".popup__close");function p(e){var c=u.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image"),p=c.querySelector(".card__title"),_=c.querySelector(".card__like-button"),m=c.querySelector(".card__likes_count"),v=c.querySelector(".card__delete-button");return a.src=e.link,a.alt=e.name,p.textContent=e.name,m.textContent=e.likes.length,e.likes.some((function(e){return e._id===f}))&&_.classList.add("card__like-button_is-active"),e.owner._id!==f&&v.classList.add("card__delete-button_noactive"),_.addEventListener("click",(function(t){return function(e,t,o){o.target.classList.contains("card__like-button_is-active")?n("DELETE",e).then((function(e){t.textContent=e.likes.length,o.target.classList.remove("card__like-button_is-active")})).catch((function(e){return console.log(e)})):n("PUT",e).then((function(e){t.textContent=e.likes.length,o.target.classList.add("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}(e._id,m,t)})),v.addEventListener("click",(function(){var n;(n=e._id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){c.remove()})).catch((function(e){return console.log(e)}))})),a.addEventListener("click",(function(){s.src=e.link,s.alt=e.name,l.textContent=e.name,d.addEventListener("click",(function(){r(i)})),o(i)})),c}function _(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}var f,m,v=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup_type_avatar"),q=document.querySelectorAll(".popup__button"),k=document.querySelector(".profile__edit-button"),L=y.querySelector(".popup__close"),C=y.querySelector(".popup__form"),g=document.querySelector(".profile__add-button"),E=h.querySelector(".popup__close"),x=h.querySelector(".popup__form"),j=y.querySelector(".popup__input_type_name"),P=y.querySelector(".popup__input_type_description"),T=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),A=document.querySelector(".profile__image-container"),I=document.querySelector(".profile__image"),O=b.querySelector(".popup__form"),w=b.querySelector(".popup__close"),D=h.querySelector(".popup__input_type_card-name"),N=h.querySelector(".popup__input_type_url");fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){T.textContent=e.name,U.textContent=e.about,I.style.backgroundImage="url(".concat(e.avatar,")"),f=e._id})).catch((function(e){console.log(e)})),C.addEventListener("submit",(function(e){e.preventDefault();var n=j.value,o=P.value;q[0].textContent="Сохранение...",function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n,o).then((function(e){T.textContent=e.name,U.textContent=e.about,r(y)})).catch((function(e){console.log(e)})).finally((function(){q[0].textContent="Сохранить"}))})),k.addEventListener("click",(function(){j.value=T.textContent,P.value=U.textContent,o(y)})),L.addEventListener("click",(function(){r(y)})),g.addEventListener("click",(function(){o(h)})),E.addEventListener("click",(function(){x.reset(),r(h)})),w.addEventListener("click",(function(){O.reset(),r(b)})),x.addEventListener("submit",(function(e){e.preventDefault();var n,o,c=D.value,a=N.value;q[1].textContent="Создание...",(n=c,o=a,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=p(e);v.prepend(t),r(h),x.reset()})).catch((function(e){return console.log(e)})).finally((function(){q[1].textContent="Создать"}))})),A.addEventListener("click",(function(){o(b)})),O.addEventListener("submit",(function(e){e.preventDefault();var n,o=document.getElementById("url-input_avatar").value;q[2].textContent="Сохранeние...",(n=o,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){I.style.backgroundImage="url(".concat(e.avatar,")"),r(b),O.reset()})).catch((function(e){return console.log(e)})).finally((function(){q[2].textContent="Сохранить"}))})),h.classList.add("popup_is-animated"),S.classList.add("popup_is-animated"),y.classList.add("popup_is-animated"),b.classList.add(".popup_is-animated"),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){v.append(p(e))}))})).catch((function(e){return console.log(e)})),m={formClass:".popup__form",inputClass:".popup__input",inputErrorClass:"popup__input_error",buttonClass:".popup__button",buttonInactiveClass:"popup__button_inactive",errorClass:"popup__error-text_active"},Array.from(document.querySelectorAll(m.formClass)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputClass)),o=e.querySelector(t.buttonClass);_(n,o,t.buttonInactiveClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent="",t.classList.remove(n),r.classList.remove(o)}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));c.textContent=n,t.classList.add(o),c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,r,t.inputErrorClass,t.errorClass),_(n,o,t.buttonInactiveClass)}))}))}(e,m)}))})();